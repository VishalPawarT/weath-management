<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
	  xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title layout:title-pattern="$DECORATOR_TITLE - $CONTENT_TITLE">TechAmes Admin</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css" th:href="@{/assets/bootstrap/css/bootstrap.min.css}"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css"
    						th:href="@{https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css}"/>
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css"
    						th:href="@{https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css}"/>
    <link rel="stylesheet" href="assets/dist/css/AdminLTE.min.css" th:href="@{/assets/dist/css/AdminLTE.min.css}"/>
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect.
    -->
    
     <link rel="stylesheet" href="assets/datatables/datatables.min.css" th:href="@{/assets/datatables/datatables.min.css}"/>
    
    <link rel="stylesheet" href="assets/dist/css/skins/skin-blue.min.css" th:href="@{/assets/dist/css/skins/skin-blue.min.css}"/>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <style>
    .goog-te-banner-frame.skiptranslate {
    display: none !important;
    } 
	body {
    top: 0px !important; 
    }
    </style>
    
  </head>
  
  <body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">

      <!-- Main Header -->
      <header class="main-header">

        <!-- Logo -->
        <a href="#" th:href="@{/home}" class="logo">
          <!-- mini logo for sidebar mini 50x50 pixels -->
          <span class="logo-mini"><b>TA</b></span>
          <!-- logo for regular state and mobile devices -->
          <span class="logo-lg"><b>TechAmes Admin</b></span>
        </a>

        <!-- Header Navbar -->
        <nav class="navbar navbar-static-top" role="navigation">
          <!-- Sidebar toggle button-->
          <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
            <span class="sr-only">Toggle navigation</span>
          </a>
          <!-- Navbar Right Menu -->
          <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
              
              <!-- User Account Menu -->
              <li class="dropdown user user-menu">
                <!-- Menu Toggle Button -->
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <!-- The user image in the navbar-->
                  <img th:src="@{/assets/dist/img/user.png}" class="user-image" alt="User Image"/>
                  <!-- hidden-xs hides the username on small devices so only the image appears. -->
                  <span class="hidden-xs" sec:authentication="principal.user.name">User</span>
                </a>
                <ul class="dropdown-menu">
                  <!-- The user image in the menu -->
                  <li class="user-header">
                    <img th:src="@{/assets/dist/img/user.png}" class="img-circle" alt="User Image"/>
                    <p>
                      <span sec:authentication="principal.user.name">User</span>
                    </p>
                  </li>
                  
                  
                  
                  
                  <!-- Menu Footer-->
                  <li class="user-footer">
                    <div class="pull-left">
                      <a href="#" th:href="@{/myAccount}" class="btn btn-default btn-flat">Profile</a>
                    </div>
                    <div class="pull-right">
                      <a href="logout" th:href="@{/logout}" class="btn btn-default btn-flat">Sign out</a>
                    </div>
                    
                  </li>
                </ul>
              </li>
              
            </ul>
          </div>
        </nav>
	      </header>
      <!-- Left side column. contains the logo and sidebar -->
      <aside class="main-sidebar">

        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">

          <!-- Sidebar user panel (optional) -->
          <div class="user-panel">
            <div class="pull-left image">
              <img th:src="@{/assets/dist/img/user.png}" class="img-circle" alt="User Image"/>
            </div>
            <div class="pull-left info">
              <p><span sec:authentication="principal.user.name">User</span></p>
              <!-- Status -->
              <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
            </div>
          </div>

          <!-- Sidebar Menu -->
          <ul class="sidebar-menu">
            <!-- <li class="header">HEADER</li> -->
            <!-- Optionally, you can add icons to the links -->
            <li th:class="${CURRENT_MENU == 'Home'}? 'active' : ''" ><a href="#" th:href="@{'/home'}"><i class="fa fa-home"></i> <span th:text="#{label.layout.dashboard}">DashBoard</span></a></li>
           <!--  <li th:class="${CURRENT_MENU == 'Categories'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_CATEGORIES')"><a href="#" th:href="@{'/credit_management'}"><i class="fa fa-folder-open"></i> <span>Credit Reports</span></a></li> -->
            
            <li th:class="${CURRENT_MENU == 'Categories'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_CATEGORIES')"><a href="#" th:href="@{'/reports'}"><i class="fa fa-folder-open"></i> <span th:text="#{label.layout.reports}">Reports</span></a></li>
            
            <li th:class="${CURRENT_MENU == 'Categories'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_CATEGORIES')"><a href="#" th:href="@{'/credit_management/new'}"><i class="fa fa-folder-open"></i> <span>Add Credit Transaction</span></a></li>
            
           <!--  <li th:class="${CURRENT_MENU == 'Products'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_PRODUCTS')"><a href="#" th:href="@{'/debit_management'}"><i class="fa fa-file"></i> <span>Debit Reports</span></a></li> -->
            <li th:class="${CURRENT_MENU == 'Products'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_PRODUCTS')"><a href="#" th:href="@{'/debit_management/new'}"><i class="fa fa-file"></i> <span>Add Debit Transaction</span></a></li>
            <li th:class="${CURRENT_MENU == 'Sources'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_ORDERS')"><a href="#" th:href="@{'/sources'}"><i class="fa fa-cart-arrow-down"></i> <span>Add New Source </span></a></li>
            <li th:class="${CURRENT_MENU == 'Sources'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_ORDERS')"><a href="#" th:href="@{'/clients'}"><i class="fa fa-cart-arrow-down"></i> <span>Add New clients </span></a></li>
           <!--  <li th:class="${CURRENT_MENU == 'Customers'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_CUSTOMERS')"><a href="#" th:href="@{'/customers'}"><i class="fa fa-smile-o"></i> <span>Customers</span></a></li> -->
            <li th:class="${CURRENT_MENU == 'Users'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_USERS')"><a href="#" th:href="@{'/users'}"><i class="fa fa-users"></i> Users</a></li>
            <li th:class="${CURRENT_MENU == 'Roles'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_ROLES')"><a href="#" th:href="@{'/roles'}"><i class="fa fa-user"></i> Roles</a></li>
            <li th:class="${CURRENT_MENU == 'Permissions'}? 'active' : ''"  sec:authorize="hasRole('ROLE_MANAGE_PERMISSIONS')"><a href="#" th:href="@{'/permissions'}"><i class="fa fa-shield"></i> Permissions</a></li>
        	<li>nbsp;<div class="mx-auto" id="google_translate_element"></div></li>    
          </ul><!-- /.sidebar-menu -->
        </section>
        <!-- /.sidebar -->
      </aside>

      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div layout:fragment="pageHeader">
        	<section class="content-header">
	        	<h1 th:text="${headerTitle}">
	            	Manage Roles
	          	</h1>
	          	<div th:if="${info}" class="col-md-3 alert alert-info alert-dismissable"  style="z-index: 1;" >
	          		<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
		        	<p><i class="icon fa fa-info"></i> <span th:text="${info}">Info</span></p>
		        </div>
                  
		        <div th:if="${error}" class="col-md-3 alert alert-danger alert-dismissable" style="z-index: 1;" >
		        	<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
		        	<p><i class="icon fa fa-ban"></i> <span th:text="${error}">Error</span></p>
		        </div>
	        </section>
        </div>

        <!-- Main content -->
        <section class="content">
          <div layout:fragment="content">
	          <!-- Your Page Content Here -->
		  </div>

        </section><!-- /.content -->
      </div><!-- /.content-wrapper -->

     <!--  Main Footer -->
      <footer class="main-footer">
    <!--     To the right
        <div class="pull-right hidden-xs">
          <strong><a href="http://sivaprasadreddy.com" target="_blank">http://sivaprasadreddy.com</a></strong>
        </div>
        Default to the left
        <strong>Copyright &copy; 2015 <a href="#">SivaLabs</a>.</strong> All rights reserved. -->
        
      </footer>

      
    </div><!-- ./wrapper -->

    <!-- REQUIRED JS SCRIPTS -->
   <!--  <script th:src="@{'/assets/plugins/jQuery/jQuery-2.1.4.min.js'}"></script> -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script th:src="@{'/assets/bootstrap/js/bootstrap.min.js'}"></script>
    <script th:src="@{'/assets/dist/js/app.min.js'}"></script>
            <script th:src="@{'/assets/datatables/datatables.min.js'}"></script>
      
    	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
        <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>    
            
  </body>
  
          <script>


          
          function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'mr', layout: google.translate.TranslateElement.InlineLayout.SIMPLE}, 'google_translate_element');
          }
         
                  
		var datatable;
         $(document).ready(function() {
        	 datatable = $('#example').DataTable( {

            	dom: 'Bfrtip',
                buttons: [
                	 {
                         extend: 'collection',
                         text: 'Export',
                         buttons: [
                             {extend: 'copy', footer: true},
                             {extend: 'excel',footer: true},
                             {extend: 'csv', footer: true},
                             {extend: 'pdf', footer: true},
                             {
                                 extend: 'print',
                                 messageTop: function () {
                                      
                                 },
                                 title: function(){
                                     return "Labour Transaction Information";
                                  }
                                 ,
                                 exportOptions: {
                                     columns: [ 0,1,2,3,4,5,6 ]
                                 }
                                 ,
                                 messageBottom: null
                             }
                         ]
                     },
        	             
                ],


                "footerCallback": function ( row, data, start, end, display ) {
                    var api = this.api(), data;
         
                    // Remove the formatting to get integer data for summation
                    var intVal = function ( i ) {
                        return typeof i === 'string' ?
                            i.replace(/[\$,]/g, '')*1 :
                            typeof i === 'number' ?
                                i : 0;
                    };
         
                    // Total over all pages
                    total = api
                        .column( 2 )
                        .data()
                        .reduce( function (a, b) {
                            return intVal(a) + intVal(b);
                        }, 0 );
         
                    // Total over this page
                    pageTotal = api
                        .column( 2, { page: 'current'} )
                        .data()
                        .reduce( function (a, b) {
                            return intVal(a) + intVal(b);
                        }, 0 );
         
                    // Update footer
                    $( api.column( 2 ).footer() ).html(
                        '₹'+pageTotal +' ( ₹'+ total +' total)'
                    );
                }



                } );
        } );


         var jsonData = {
        		 "11111111": [
        		     { "x": "2016-6-25 12:58:52", "y": 10.22 },
        		     { "x": "2016-7-25 13:33:23", "y": 11.14 },
        		     { "x": "2016-8-25 13:49:18", "y": 13.58 },
        		     { "x": "2016-9-25 13:55:01", "y": 15.25 },
        		     { "x": "2016-10-25 14:00:15", "y": 17.25 },
        		 ],
        		 "22222222": [
        		      { "x": "2016-6-25 12:58:52", "y": 19.99 },
        		      { "x": "2016-7-25 13:33:23", "y": 21.78 },
        		      { "x": "2016-8-25 13:49:18", "y": 23.45 },
        		      { "x": "2016-9-25 13:55:01", "y": 24.73 },
        		      { "x": "2016-10-25 14:00:15", "y": 26.58 }
        		 ],
        		 "33333333": [
        		     { "x": "2016-6-25 12:58:52", "y": 27.66 },
        		     { "x": "2016-7-25 13:33:23", "y": 28.68 },
        		     { "x": "2016-8-25 13:49:18", "y": 30.73 },
        		     { "x": "2016-9-25 13:55:01", "y": 32.46 },
        		     { "x": "2016-10-25 14:00:15", "y": 34.79 }
        		 ],
        		 "44444444": [
        		     { "x": "2016-6-25 12:58:52", "y": 10.22 },
        		     { "x": "2016-7-25 13:33:23", "y": 11.14 },
        		     { "x": "2016-8-25 13:49:18", "y": 15.25 },
        		     { "x": "2016-9-25 13:55:01", "y": 19.99 },
        		     { "x": "2016-10-25 14:00:15", "y": 21.78 }
        		 ],
        		 "55555555": [
        		     { "x": "2016-6-25 12:58:52", "y": 24.73 },
        		     { "x": "2016-7-25 13:33:23", "y": 26.58 },
        		     { "x": "2016-8-25 13:49:18", "y": 27.66 },
        		     { "x": "2016-9-25 13:55:01", "y": 28.68 },
        		     { "x": "2016-10-25 14:00:15", "y": 32.46 }
        		 ]};


/*         window.onload = function() {
         
        var dps = [[]];
        var chart = new CanvasJS.Chart("chartContainer", {
        	animationEnabled: true,
        	theme: "light2", // "light1", "dark1", "dark2"
        	title: {
        		text: "Highest Mountain Peaks"
        	},
        	subtitles: [{
        		text: "Based on Elevation"
        	}],
        	axisY: {
        		title: "Elevation (in metres)",
        		suffix: " m",
        		includeZero: false
        	},
        	axisX: {
        		title: "Mountains"
        	},
        	data: [{
        		type: "column",
        		yValueFormatString: "#,##0 m",
        		dataPoints: dps[0]
        	}]
        });

        chart.render();
        
        } */


        var dataPoints = [];
        var chart = new CanvasJS.Chart("chartContainer",
        {
        	 dataPointWidth: 20,
        	animationEnabled: true,
        	axisX: {
          	valueFormatString: "DD-MM-YY",

          },
        	data: [{
           /*  type: 'column',
            //xValueFormatString:"D MM h:mm",
            xValueType: "dateTime",
            showInLegend: true, */
            name: "series1",
            legendText: "Days",
            dataPoints: dataPoints // this should contain only specific serial number data

        	}]
        });

        $( ".dropdown" ).change(function() {
        	chart.options.data[0].dataPoints = [];
          var e = document.getElementById("dd");
        	var selected = e.options[e.selectedIndex].value;

        	var transType = e.value;

    		$.ajax({
    	        type: 'get',
    	        url: 'getGraph?transType='+transType,
    	        processData: true,
    	        success: function (data) {
					var jsonResp = JSON.parse(data);
					console.log(jsonResp);
					  for(var i in jsonResp) {
					  	var xVal = jsonResp[i].date;
						var yVal = jsonResp[i].amount;
						alert('value got' + xVal + yVal);
						chart.options.data[0].dataPoints.push({x: new Date(xVal), y: yVal});
					  }
					  chart.render();
					
				}
    	    });
          
        });


        $( "#reportBar" ).change(function() {
            var e = document.getElementById("reportBar");
        	var selected = e.options[e.selectedIndex].value;
			var sourceName = e.options[e.selectedIndex].innerText;
			alert('we got' + sourceName);
        	var sourceId = selected;
        	var url = 'getSourceWiseReports?sourceInfo=sourceId1XXXsourceName1';
        	var url = url.replace('sourceName1',sourceName).replace('sourceId1',sourceId);
    		$.ajax({
    	        type: 'get',
    	        url: url,
    	        processData: true,
    	        success: function (data) {
					var respList = JSON.parse(data);
					console.log('respose data got');
        	        console.log(data);
        	        datatable.clear().draw();
        	        datatable.destroy();
        	        for(var i in respList) {
        	        	$('#reportTBody').append('<tr>' 
                	        + '<td>' + respList[i].userId + '</td>'
                	        + '<td>' + respList[i].transactionDate + '</td>'
                	        + '<td>' + respList[i].totalCreditAmount + '</td>'
                	        + '<td>' + respList[i].totalDebitAmount + '</td>'
                	        + '<td>' + respList[i].balance + '</td>'
                	        + '<td>' + respList[i].sourceName + '</td>'
                	        + '</tr>');
					}

        	        datatable = getTableInstance();
        	        
    	        }
    	    });
          
        });
        

        </script>
        
        
            <script>

	function selectSource(element) {
		var sourceId = $(element).val();
		var sourceName = $(element).find("option:selected").text();
		$('#sourceName').val(sourceName);
	}

	function showTransactionData(element) {
		console.log($(element).parent().children());
		var transId = $(element).parent().parent().children().eq(0).text();
		alert('value' + transId);
		if(creditJson.hasOwnProperty(transId)) {
			var li = creditJson[transId];
			var transObject = li[0];
			console.log('setting ojbect');
			console.log(transObject);
			$('#crTransactionAmountPass').val(transObject.crTransactionAmount);
			$('#crTransactionMoneyGiverPass').val(transObject.crTransactionMoneyGiver);
			$('#crTransactionMoneyTakerPass').val(transObject.crTransactionMoneyTaker);
			$('#crTransactionPaymentModePass').val(transObject.crTransactionPaymentMode);
			$('#crTransactionDescriptionPass').val(transObject.crTransactionDescription);
			$('#crTransactionSourceNamePass').val(transObject.crTransactionSourceName);
		}
    }		


	function getTableInstance() {

		return $('#example').DataTable( {

        	dom: 'Bfrtip',
            buttons: [
            	 {
                     extend: 'collection',
                     text: 'Export',
                     buttons: [
                         {extend: 'copy', footer: true},
                         {extend: 'excel',footer: true},
                         {extend: 'csv', footer: true},
                         {extend: 'pdf', footer: true},
                         {
                             extend: 'print',
                             messageTop: function () {
                                  
                             },
                             title: function(){
                                 return "Labour Transaction Information";
                              }
                             ,
                             exportOptions: {
                                 columns: [ 0,1,2,3,4,5,6 ]
                             }
                             ,
                             messageBottom: null
                         }
                     ]
                 },
    	             
            ],


            "footerCallback": function ( row, data, start, end, display ) {
                var api = this.api(), data;
     
                // Remove the formatting to get integer data for summation
                var intVal = function ( i ) {
                    return typeof i === 'string' ?
                        i.replace(/[\$,]/g, '')*1 :
                        typeof i === 'number' ?
                            i : 0;
                };
     
                // Total over all pages
                total = api
                    .column( 2 )
                    .data()
                    .reduce( function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0 );
     
                // Total over this page
                pageTotal = api
                    .column( 2, { page: 'current'} )
                    .data()
                    .reduce( function (a, b) {
                        return intVal(a) + intVal(b);
                    }, 0 );
     
                // Update footer
                $( api.column( 2 ).footer() ).html(
                    '₹'+pageTotal +' ( ₹'+ total +' total)'
                );
            }



            } );


		}
	
    </script>
    
  
</html>
